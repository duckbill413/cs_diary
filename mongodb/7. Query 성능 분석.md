# Query 성능 분석
- [Query 성능 분석](#query-성능-분석)
  - [Query Planner Logic](#query-planner-logic)
  - [Query Plan 읽는 방법](#query-plan-읽는-방법)

## Query Planner Logic
- Query 수행 속도
  1. `db.test.find({a: 1})` -> 느린 응답
      - query -> disk -> cache -> return 
  2. `db.test.find({a: 1})` -> 빠른 응답
      - query -> **cache** -> return

- `Working Set`
  - 10년간 운영됨 Messaging Server 가 존재할 때
  - 1년에 1PB의 데이터가 누적된다고 하자
  - 이때 실제로 사용되는 데이터는 1 month -> 100GB 정도이고 이것을 `Working Set`이라 한다.

- Disk 와 Cache
  - Speed: Disk < Cache
  - Storage: Disk > Cache

- `Cache Eviction`
  - 100GB Working Set > 80GB Cache 일때
  - 20GB의 용량 부족을 해결하기 위해서 
  - 캐시를 올리고 내리는 작업을 하게된다.
  - 이것을 `Cache Eviction`이라고 한다.

- 문제 해결
  - Server Spec 업 스케일링: 비용이 발생되는 해결 방법
  - 모델링
  - 쿼리 튜닝
  - 비즈니스 요구사항 변경
  - `MongoDB` 내부적으로 `Optimizer`가 최적의 실행 계획을 만들어 주는 것 (`Query Plan`)
  
- Optimizer의 `Query Plan`은 최적일까?
  - Optimizer의 실행 계획은 항상 최적이 아니다.
  - 따라서, Query Plan 을 분석하고
  - 쿼리 튜닝을 진행함으로써 최적화된 쿼리를 만들어줄 필요가 있다.

## Query Plan 읽는 방법
